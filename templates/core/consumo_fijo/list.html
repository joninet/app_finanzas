{% extends 'base.html' %}

{% block title %}Consumos Fijos - Finanzas Personales{% endblock %}

{% block page_title %}Consumos Fijos Mensuales{% endblock %}

{% block content %}
<div class="mb-6">
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
        <form class="flex flex-wrap items-center gap-2">
            <div class="flex items-center space-x-2">
                <span class="text-gray-500"><i class="fas fa-calendar-alt"></i></span>
                <input type="month" class="form-input rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" id="mes_filtro" name="mes" value="{{ año_actual }}-{{ mes_actual|stringformat:'02d' }}" aria-label="Mes">
            </div>
            <select name="pagado" class="form-select rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" style="min-width: 10rem;">
                <option value="">Todos</option>
                <option value="1" {% if pagado == '1' %}selected{% endif %}>Pagados</option>
                <option value="0" {% if pagado == '0' %}selected{% endif %}>Pendientes</option>
            </select>
            <button type="submit" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition">
                <i class="fas fa-filter"></i>
            </button>
        </form>
        <a href="{% url 'consumo_fijo_create' %}" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded inline-flex items-center transition">
            <i class="fas fa-plus mr-2"></i> Nuevo Consumo Fijo
        </a>
    </div>
</div>

<div class="bg-white rounded-lg shadow-md overflow-hidden">
    <div class="bg-blue-600 px-6 py-4 border-b border-blue-700">
        <h5 class="text-xl font-bold text-white flex items-center"><i class="fas fa-calendar-alt mr-2"></i>Lista de Consumos Fijos ({{ mes_nombre }} {{ año_actual }})</h5>
    </div>
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Categoría</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo de Pago</th>
                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Monto</th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha Pago</th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for consumo in consumos_fijos %}
                <tr class="hover:bg-gray-50 transition">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ consumo.categoria.nombre }}</td>
                    <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">{{ consumo.descripcion|default:"--" }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ consumo.tipo_pago.nombre }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-red-600 font-medium">${{ consumo.monto|floatformat:2 }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-center text-sm">
                        {% if consumo.pagado %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            Pagado
                        </span>
                        {% else %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                            Pendiente
                        </span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        {% if consumo.fecha_pago %}
                        {{ consumo.fecha_pago|date:"d/m/Y" }}
                        {% else %}
                        <span class="text-gray-400">--</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                        {% if not consumo.pagado %}
                        <a href="{% url 'consumo_fijo_toggle' consumo.id %}" class="text-white bg-green-600 hover:bg-green-700 px-3 py-1.5 rounded mr-2 transition inline-block" title="Marcar como pagado">
                            <i class="fas fa-check"></i>
                        </a>
                        {% else %}
                        <a href="{% url 'consumo_fijo_toggle' consumo.id %}" class="text-gray-800 bg-yellow-400 hover:bg-yellow-500 px-3 py-1.5 rounded mr-2 transition inline-block" title="Marcar como pendiente">
                            <i class="fas fa-undo"></i>
                        </a>
                        {% endif %}
                        <a href="{% url 'consumo_fijo_update' consumo.id %}" class="text-white bg-blue-600 hover:bg-blue-700 px-3 py-1.5 rounded mr-2 transition inline-block" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="{% url 'consumo_fijo_delete' consumo.id %}" class="text-white bg-red-600 hover:bg-red-700 px-3 py-1.5 rounded transition inline-block" title="Eliminar">
                            <i class="fas fa-trash"></i>
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="px-6 py-10 text-center text-gray-500 italic">No hay consumos fijos registrados para el período seleccionado</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot class="bg-gray-50 border-t border-gray-200">
                {% if consumos_fijos %}
                <tr class="bg-blue-50">
                    <td colspan="3" class="px-6 py-3 text-right text-sm font-bold text-gray-900">Total</td>
                    <td class="px-6 py-3 text-right text-sm font-bold text-red-600">${{ total_consumos|floatformat:2 }}</td>
                    <td colspan="3"></td>
                </tr>
                <tr class="bg-green-50">
                    <td colspan="3" class="px-6 py-3 text-right text-sm font-bold text-gray-900">Total Pagado</td>
                    <td class="px-6 py-3 text-right text-sm font-bold text-green-600">${{ total_pagado|floatformat:2 }}</td>
                    <td colspan="3"></td>
                </tr>
                <tr class="bg-yellow-50">
                    <td colspan="3" class="px-6 py-3 text-right text-sm font-bold text-gray-900">Total Pendiente</td>
                    <td class="px-6 py-3 text-right text-sm font-bold text-red-600">${{ total_pendiente|floatformat:2 }}</td>
                    <td colspan="3"></td>
                </tr>
                {% endif %}
            </tfoot>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Enviar formulario automáticamente al cambiar los filtros
        const mesFiltro = document.getElementById('mes_filtro');
        const estadoFiltro = document.querySelector('select[name="pagado"]');
        
        mesFiltro.addEventListener('change', function() {
            this.form.submit();
        });
        
        estadoFiltro.addEventListener('change', function() {
            this.form.submit();
        });
    });
</script>
{% endblock %}
