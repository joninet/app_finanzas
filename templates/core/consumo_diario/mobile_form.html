{% extends 'base.html' %}

{% block title %}Nuevo Consumo - Finanzas{% endblock %}

{% block extra_css %}
<style>
    /* Estilos específicos para la versión móvil */
    .container-mobile {
        max-width: 100%;
        padding: 10px;
    }
    
    /* Para ocultar el header y footer en la versión móvil */
    .hide-in-mobile {
        display: none;
    }
</style>
{% endblock %}

{% block header_class %}hide-in-mobile{% endblock %}
{% block footer_class %}hide-in-mobile{% endblock %}

{% block content %}
<div class="container-mobile">
    <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <div class="bg-blue-600 px-4 py-3 border-b border-blue-700 flex justify-between items-center">
            <h5 class="text-lg font-bold text-white flex items-center">
                <i class="fas fa-plus-circle mr-2"></i>Nuevo Consumo
            </h5>
            <a href="{% url 'consumo_diario_list' %}" class="px-2 py-1 bg-white text-blue-600 rounded text-sm font-medium hover:bg-gray-100">
                <i class="fas fa-list"></i> Ver Todos
            </a>
        </div>
        
        <div class="p-4">
            {% if messages %}
            <div class="mb-4">
                {% for message in messages %}
                <div class="p-3 rounded mb-2 {% if message.tags == 'error' %}bg-red-100 text-red-800 border-l-4 border-red-500{% elif message.tags == 'success' %}bg-green-100 text-green-800 border-l-4 border-green-500{% else %}bg-blue-100 text-blue-800 border-l-4 border-blue-500{% endif %}" role="alert">
                    {{ message }}
                    <button type="button" class="float-right text-lg font-bold" onclick="this.parentElement.remove()">&times;</button>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <form method="post" class="space-y-4">
                {% csrf_token %}
                
                <div>
                    <label for="monto" class="block text-lg font-bold text-gray-800 mb-1">Monto ($) *</label>
                    <input type="number" class="w-full px-4 py-3 text-xl border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="monto" name="monto" step="0.01" required autofocus inputmode="decimal">
                </div>
                
                <div>
                    <label for="categoria" class="block text-base font-bold text-gray-700 mb-1">Categoría *</label>
                    <select class="w-full px-4 py-3 text-lg border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="categoria" name="categoria" required>
                        <option value="" selected disabled>Seleccione</option>
                        {% for categoria in categorias %}
                        <option value="{{ categoria.id }}">{{ categoria.nombre }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label for="tipo_pago" class="block text-base font-bold text-gray-700 mb-1">Tipo de Pago *</label>
                    <select class="w-full px-4 py-3 text-lg border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="tipo_pago" name="tipo_pago" required>
                        <option value="" selected disabled>Seleccione pago</option>
                        {% for tipo in tipos_pago %}
                        <option value="{{ tipo.id }}" data-tarjeta="{{ tipo.es_tarjeta_credito|yesno:'true,false' }}">{{ tipo.nombre }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label for="fecha" class="block text-base font-bold text-gray-700 mb-1">Fecha</label>
                    <input type="date" class="w-full px-4 py-3 text-lg border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="fecha" name="fecha" value="{{ fecha_actual }}">
                </div>
                
                <div id="credito-container" style="display: none;" class="bg-gray-50 p-3 rounded-lg border border-gray-200">
                    <div class="flex items-center mb-3">
                        <div class="relative inline-block w-12 mr-2 align-middle select-none transition duration-200 ease-in">
                            <input type="checkbox" name="es_credito" id="es_credito" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                            <label for="es_credito" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                        </div>
                        <label for="es_credito" class="text-lg font-medium text-gray-700">¿Pago en cuotas?</label>
                    </div>
                    
                    <div id="cuotas-container" style="display: none;">
                        <div>
                            <label for="cuotas" class="block text-base font-medium text-gray-700 mb-1">Número de cuotas</label>
                            <input type="number" class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm" id="cuotas" name="cuotas" value="1" min="1" inputmode="numeric">
                        </div>
                    </div>
                </div>
                
                <div>
                    <label for="descripcion" class="block text-base font-bold text-gray-700 mb-1">Descripción</label>
                    <input type="text" class="w-full px-4 py-3 text-lg border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="descripcion" name="descripcion" placeholder="(Opcional)">
                </div>
                
                <div class="grid grid-cols-1 gap-3 pt-2">
                    <button type="submit" class="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold text-xl rounded-lg shadow-md focus:outline-none focus:ring-4 focus:ring-blue-300 transition-colors">
                        <i class="fas fa-save mr-2"></i> Guardar
                    </button>
                    <a href="{% url 'consumo_diario_list' %}" class="w-full py-3 bg-white text-gray-700 border border-gray-300 font-bold text-center text-lg rounded-lg shadow-sm hover:bg-gray-50 focus:outline-none transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i> Volver
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
/* Custom Toggle Switch for Tailwind */
.toggle-checkbox:checked {
    right: 0;
    border-color: #2563eb;
}
.toggle-checkbox:checked + .toggle-label {
    background-color: #2563eb;
}
.toggle-checkbox {
    right: 0;
    transition: all 0.3s ease-in-out;
    border-color: #d1d5db;
}
.toggle-label {
    width: 3rem;
}
.toggle-checkbox {
    right: calc(100% - 1.5rem);
}
.toggle-checkbox:checked {
    right: 0;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const tipoSelect = document.getElementById('tipo_pago');
        const creditoContainer = document.getElementById('credito-container');
        const esCreditoCheckbox = document.getElementById('es_credito');
        const cuotasContainer = document.getElementById('cuotas-container');
        
        // Mostrar/ocultar opciones de crédito según el tipo de pago
        tipoSelect.addEventListener('change', function() {
            const option = tipoSelect.options[tipoSelect.selectedIndex];
            const esTarjeta = option.getAttribute('data-tarjeta') === 'true';
            
            if (esTarjeta) {
                creditoContainer.style.display = 'block';
            } else {
                creditoContainer.style.display = 'none';
                esCreditoCheckbox.checked = false;
                cuotasContainer.style.display = 'none';
            }
        });
        
        // Mostrar/ocultar número de cuotas según el checkbox
        esCreditoCheckbox.addEventListener('change', function() {
            if (esCreditoCheckbox.checked) {
                cuotasContainer.style.display = 'block';
            } else {
                cuotasContainer.style.display = 'none';
                document.getElementById('cuotas').value = '1';
            }
        });
        
        // Configura la fecha por defecto como hoy
        if (!document.getElementById('fecha').value) {
            document.getElementById('fecha').value = '{{ fecha_actual }}';
        }
        
        // Auto-enfoque en el campo de monto
        document.getElementById('monto').focus();
    });
</script>
{% endblock %}
